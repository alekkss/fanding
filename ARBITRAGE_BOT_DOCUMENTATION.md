# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π –±–æ—Ç –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–π –±–∏—Ä–∂–∏ Bybit. –°–∏—Å—Ç–µ–º–∞ —Ç–æ—Ä–≥—É–µ—Ç –∞—Ä–±–∏—Ç—Ä–∞–∂–µ–º –º–µ–∂–¥—É —Å–ø–æ—Ç –∏ —Ñ—å—é—á–µ—Ä—Å–Ω—ã–º–∏ —Ä—ã–Ω–∫–∞–º–∏, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—è –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º funding rate –∏ —Å–ø—Ä–µ–¥–∞—Ö —Ü–µ–Ω. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é —Ü–µ–ª–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Exchange**: Bybit API v5
- **Strategy**: Spot-Futures Arbitrage (Cash & Carry)
- **Concurrency**: Threading + ThreadPoolExecutor
- **Rate Limiting**: Token Bucket Algorithm
- **Storage**: JSON-—Ñ–∞–π–ª—ã (–ø–æ–∑–∏—Ü–∏–∏, blacklist, –∏—Å—Ç–æ—Ä–∏—è)
- **Logging**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—Ä–æ–≤–Ω—è–º–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/
‚îú‚îÄ‚îÄ main.py                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–∑–∞–ø—É—Å–∫–∞–µ—Ç orchestrator)
‚îú‚îÄ‚îÄ .env                             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (API –∫–ª—é—á–∏ Bybit)
‚îÇ
‚îú‚îÄ‚îÄ orchestrator.py                  # –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ config.py                        # –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ /api/
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py                # –ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç Bybit API (GET/POST —Å retry)
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                      # API –∫–ª—é—á–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ HMAC
‚îÇ   ‚îî‚îÄ‚îÄ rate_limiter.py              # Rate limiting (requests/sec, weight/sec)
‚îÇ
‚îú‚îÄ‚îÄ /services/
‚îÇ   ‚îú‚îÄ‚îÄ price_service.py             # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω (orderbook, ticker)
‚îÇ   ‚îú‚îÄ‚îÄ funding_rate_service.py      # –ü–æ–ª—É—á–µ–Ω–∏–µ funding rates
‚îÇ   ‚îú‚îÄ‚îÄ spread_analyzer.py           # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–ø—Ä–µ–¥–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ arbitrage_calculator.py      # –†–∞—Å—á–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
‚îÇ   ‚îú‚îÄ‚îÄ opportunity_monitor.py       # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (–æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π)
‚îÇ   ‚îî‚îÄ‚îÄ order_executor.py            # –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ (—Å–ø–æ—Ç/—Ñ—å—é—á–µ—Ä—Å)
‚îÇ
‚îú‚îÄ‚îÄ /managers/
‚îÇ   ‚îú‚îÄ‚îÄ position_manager.py          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏ (MultiPositionManager)
‚îÇ   ‚îú‚îÄ‚îÄ blacklist_manager.py         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ blacklist (Singleton)
‚îÇ   ‚îú‚îÄ‚îÄ leverage_manager.py          # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–µ—á–∞
‚îÇ   ‚îî‚îÄ‚îÄ balance.py                   # –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ /calculators/
‚îÇ   ‚îú‚îÄ‚îÄ pnl_calculator.py            # –†–∞—Å—á–µ—Ç PnL –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ funding_calculator.py        # –†–∞—Å—á–µ—Ç –†–ï–ê–õ–¨–ù–û–ì–û —Ñ–∞–Ω–¥–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ API
‚îÇ
‚îú‚îÄ‚îÄ /utils/
‚îÇ   ‚îú‚îÄ‚îÄ logger_config.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ utils.py                     # –£—Ç–∏–ª–∏—Ç—ã (timestamp –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞)
‚îÇ
‚îî‚îÄ‚îÄ positions/                   # JSON —Ñ–∞–π–ª—ã –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
    ‚îÇ   ‚îî‚îÄ‚îÄ closed_positions_history.json
    ‚îî‚îÄ‚îÄ blacklist.json               # –°–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
```

## –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. MultiCryptoOrchestrator (orchestrator.py)

**–ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä** —Å –¥–≤—É–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏:

#### –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞ (`scan_opportunities`)
- –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä —Å Bybit
- –§–∏–ª—å—Ç—Ä—É–µ—Ç blacklist –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø—Ä–µ–¥—ã —á–µ—Ä–µ–∑ `SpreadAnalyzer`
- –ü–æ–ª—É—á–∞–µ—Ç funding rates
- –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–ø-N –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Ç–æ–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–π (`monitor_position`)
- –ö–∞–∂–¥–∞—è –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º daemon-–ø–æ—Ç–æ–∫–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞–∂–¥—ã–µ 300 —Å–µ–∫—É–Ω–¥
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 2 —Ä–µ–∂–∏–º–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:
  - **–û–±—ã—á–Ω—ã–π**: FR < -0.001% –ò —Å–ø—Ä–µ–¥ <= 0.15%
  - **–ú—è–≥–∫–∏–π**: FR <= 0.005% –ò —Å–ø—Ä–µ–¥ <= 0.15% (–ø–æ—Å–ª–µ 15+ —Ä–∞—É–Ω–¥–æ–≤ —Å –Ω–∏–∑–∫–∏–º FR)

### 2. OpportunityMonitor (opportunity_monitor.py)

**–õ–æ–≥–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏**: –æ—Ç–∫—Ä—ã—Ç–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π

#### –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (`monitor_and_execute`)
```
–£—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞:
1. spread_pct >= 0.45%   (MIN_ENTRY_SPREAD_PCT)
2. funding_rate >= 0.02% (MIN_FUNDING_RATE)

–ü–æ—Ä—è–¥–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:
1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–µ—á–∞ (LEVERAGE = 1)
2Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç–∏–µ –§–¨–Æ–ß–ï–†–°–ê (SHORT)  ‚Üê –°–ù–ê–ß–ê–õ–ê!
3Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç–∏–µ –°–ü–û–¢–ê (LONG)
   ‚ö†Ô∏è –ï—Å–ª–∏ —Å–ø–æ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è ‚Üí –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø
```

#### –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (`monitor_open_position_single`)
```
–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º:
- FR < -0.001% (CLOSE_FR_THRESHOLD)
- –°–ø—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏—è <= 0.15% (MAX_CLOSE_SPREAD_PCT)

–ú—è–≥–∫–∏–π —Ä–µ–∂–∏–º (–ø–æ—Å–ª–µ 15+ —Ä–∞—É–Ω–¥–æ–≤ —Å FR <= 0.005%):
- FR <= 0.005% (LOW_FR_TRACKING_THRESHOLD)
- –°–ø—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏—è <= 0.15%

–ü–æ—Ä—è–¥–æ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è:
1Ô∏è‚É£ –ü—Ä–æ–¥–∞–∂–∞ –°–ü–û–¢–ê (–ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –±–∞–ª–∞–Ω—Å—É)
2Ô∏è‚É£ –ü–æ–∫—É–ø–∫–∞ –§–¨–Æ–ß–ï–†–°–ê (–ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É qty)
```

### 3. MultiPositionManager (position_manager.py)

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏**:

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ (JSON)
```json
{
  "crypto": "BTC",
  "spot_entry_price": 50000.12,
  "futures_entry_price": 50050.45,
  "spot_qty": 0.0006,
  "futures_qty": 0.0006,
  "entry_spread_pct": 0.48,
  "entry_timestamp": "2026-01-03T10:30:00",
  "funding_payments_count": 5,
  "low_fr_count": 2,
  "consecutive_low_fr": false
}
```

#### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã
- `save_position()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ `positions/{crypto}.json`
- `get_position(crypto)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–∏
- `has_position(crypto)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
- `increment_funding_count()` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ funding rate –¥–ª—è –º—è–≥–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞
- `close_position_with_pnl()` - –∑–∞–∫—Ä—ã—Ç–∏–µ —Å —Ä–∞—Å—á–µ—Ç–æ–º PnL –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
- `restore_monitoring()` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

#### Thread Safety
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `threading.RLock` (—Ä–µ–µ–Ω—Ç–µ—Ä–∞–±–µ–ª—å–Ω—ã–π lock)
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤

### 4. BlacklistManager (blacklist_manager.py)

**Singleton-–º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–∞—Ä**

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ blacklist)
```python
CRITICAL_ERROR_CODES = [
    30228,  # No new positions during delisting
    10001,  # Symbol not found
    110043, # Set margin mode failed (suspended trading)
]
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ blacklist.json
```json
{
  "LUNA": {
    "reason": "Futures error: Code 30228: No new positions during delisting",
    "error_code": 30228,
    "timestamp": "2026-01-03T10:45:00"
  }
}
```

### 5. OrderExecutor (order_executor.py)

**–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞**

#### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `get_instrument_info()` - –ø–æ–ª—É—á–µ–Ω–∏–µ `qtyStep`, `basePrecision`, `minOrderQty`
- `round_to_step()` - –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ qty —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Decimal (ROUND_DOWN)
- `place_spot_order()` - Market –æ—Ä–¥–µ—Ä –Ω–∞ —Å–ø–æ—Ç (–≤ USDT, `marketUnit: quoteCoin`)
- `place_futures_order()` - Market –æ—Ä–¥–µ—Ä –Ω–∞ —Ñ—å—é—á–µ—Ä—Å (–≤ qty –º–æ–Ω–µ—Ç—ã)
- `close_spot_position_qty()` - –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–ø–æ—Ç–∞ (–ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –±–∞–ª–∞–Ω—Å—É)
- `close_futures_position()` - –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ—å—é—á–µ—Ä—Å–∞ (reduceOnly=True)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
```python
{
    "success": bool,
    "order_id": str,
    "qty": float,
    "price": float,
    "error": str | None
}
```

### 6. PnLCalculator (pnl_calculator.py)

**–†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏**

#### –§–æ—Ä–º—É–ª–∞
```
Spot PnL = (exit_price - entry_price) * spot_qty
Futures PnL = (entry_price - exit_price) * futures_qty
Price PnL = Spot PnL + Futures PnL
Commission = (entry_value + exit_value) * commission_rate
Net PnL = Price PnL + Funding - Commission
```

#### –í—ã–∑–æ–≤
```python
pnl_result = PnLCalculator.calculate_pnl(
    spot_entry_price=50000.0,
    spot_exit_price=50100.0,
    futures_entry_price=50050.0,
    futures_exit_price=50150.0,
    spot_qty=0.0006,
    futures_qty=0.0006,
    commission_rate=0.002,  # 0.2%
    total_funding_received=1.5  # USDT
)
```

### 7. RealizedFundingCalculator (funding_calculator.py)

**–†–∞—Å—á–µ—Ç –†–ï–ê–õ–¨–ù–û–ì–û –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Bybit API**

#### –ú–µ—Ç–æ–¥
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/execution/list` —Å `execType: "Funding"`
- –†–∞–∑–±–∏–≤–∞–µ—Ç –ø–µ—Ä–∏–æ–¥ –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–æ 7 –¥–Ω–µ–π (API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)
- –°—É–º–º–∏—Ä—É–µ—Ç –≤—Å–µ `execFee` (—Å –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–Ω–∞–∫–∞)
- –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ = –ø—Ä–∏–±—ã–ª—å –æ—Ç —Ñ–∞–Ω–¥–∏–Ω–≥–∞

#### –§–æ—Ä–º—É–ª–∞
```
funding_pnl = -execFee
total_funding = sum(funding_pnl for all executions)
```

### 8. Rate Limiter (rate_limiter.py)

**Token Bucket –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç rate limit**

#### –õ–∏–º–∏—Ç—ã Bybit
```python
MAX_REQUESTS_PER_SECOND = 50  # (Bybit: 120)
MAX_WEIGHT_PER_SECOND = 300   # (Bybit: 600)
```

#### –í–µ—Å–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
```python
ENDPOINT_WEIGHTS = {
    "/market/tickers": 10,
    "/market/orderbook": 5,
    "/order/create": 5,
    "/execution/list": 10,
    # ...default: 1
}
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```python
rate_limiter.wait_if_needed(endpoint)  # –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.py)

### –¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```python
TRADE_AMOUNT_USD = 30.0      # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT
LEVERAGE = 1                 # –ë–µ–∑ –ø–ª–µ—á–∞ (—Ö–µ–¥–∂)
COMMISSION_PCT = 0.27        # –°—É–º–º–∞—Ä–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è (–æ—Ç–∫—Ä—ã—Ç–∏–µ + –∑–∞–∫—Ä—ã—Ç–∏–µ)
```

### –ü–æ—Ä–æ–≥–∏ –≤—Ö–æ–¥–∞
```python
MIN_SPREAD_PCT = 0.0         # –§–∏–ª—å—Ç—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
MIN_ENTRY_SPREAD_PCT = 0.45  # –ü–æ—Ä–æ–≥ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
MIN_FUNDING_RATE = 0.02      # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π FR –¥–ª—è –≤—Ö–æ–¥–∞ (0.02% = 2 basis points)
```

### –ü–æ—Ä–æ–≥–∏ –≤—ã—Ö–æ–¥–∞
```python
CLOSE_FR_THRESHOLD = -0.001      # –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
LOW_FR_TRACKING_THRESHOLD = 0.01 # –ú—è–≥–∫–∏–π —Ä–µ–∂–∏–º
MIN_FUNDING_PAYMENTS_FOR_CLOSE = 15  # –†–∞—É–Ω–¥–æ–≤ —Å –Ω–∏–∑–∫–∏–º FR –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º—è–≥–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞
MAX_CLOSE_SPREAD_PCT = 0.15      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
```

### –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
```python
MAX_CONCURRENT_POSITIONS = 1  # –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
MAX_TRADING_THREADS = 3       # –ü–æ—Ç–æ–∫–æ–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
SCAN_INTERVAL_SEC = 180       # –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä—ã–Ω–∫–∞
MONITOR_INTERVAL_SEC = 300    # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∑–∏—Ü–∏–π
```

## –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **SOLID**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (orchestrator ‚Üí services ‚Üí managers ‚Üí api)
- **Thread Safety**: –í—Å–µ shared state –∑–∞—â–∏—â–µ–Ω locks (RLock)
- **Async Pattern**: Threading –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (daemon threads)
- **Type Hints**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- **Error Handling**: Graceful degradation —Å retry –ª–æ–≥–∏–∫–æ–π

### –ö–æ–Ω–≤–µ–Ω—Ü–∏–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
- **–ö–ª–∞—Å—Å—ã**: `PascalCase` (MultiCryptoOrchestrator, PnLCalculator)
- **–§—É–Ω–∫—Ü–∏–∏**: `snake_case` (monitor_position, calculate_pnl)
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã**: `UPPER_SNAKE_CASE` (MIN_SPREAD_PCT, TRADE_AMOUNT_USD)
- **Private –º–µ—Ç–æ–¥—ã**: `_leading_underscore` (_save_blacklist, _get_signed)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
try:
    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (API –≤—ã–∑–æ–≤, —Ñ–∞–π–ª I/O)
except SpecificException as e:
    logger.error(f"[{crypto}] –û–ø–∏—Å–∞–Ω–∏–µ: {e}", exc_info=True)
    # Retry –∏–ª–∏ return fallback –∑–Ω–∞—á–µ–Ω–∏–µ
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤
```
[2026-01-03 14:30:00] [orchestrator] [INFO] üìä –û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: 1/1
[2026-01-03 14:30:05] [BTC] [INFO] üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–∫—Ä—ã—Ç–∏—è...
[2026-01-03 14:30:05] [BTC] [INFO] ‚îî‚îÄ FR 0.0150% >= -0.001%, –∂–¥–µ–º —Å–Ω–∏–∂–µ–Ω–∏—è FR
[2026-01-03 14:35:00] [BTC] [INFO] üî• –£—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
[2026-01-03 14:35:01] [BTC] [INFO] ‚úÖ –ü–æ–∑–∏—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞
[2026-01-03 14:35:02] [orchestrator] [INFO] üí∞ NET PnL: +0.45 USDT ‚úÖ
```

### –£—Ä–æ–≤–Ω–∏
- `DEBUG`: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (API –∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π)
- `INFO`: –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π, —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `WARNING`: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (timeout, blacklist –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ)
- `ERROR`: –û—à–∏–±–∫–∏ (API failures, —Ñ–∞–π–ª I/O –ø—Ä–æ–±–ª–µ–º—ã)
- `CRITICAL`: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (—Ñ—å—é—á–µ—Ä—Å –æ—Ç–∫—Ä—ã—Ç, —Å–ø–æ—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç)

## –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã

### 1. –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ü–∏–∫–ª —Ç–æ—Ä–≥–æ–≤–ª–∏

```
1. Orchestrator.run()
   ‚Üì
2. restore_monitoring() - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π
   ‚Üì
3. scan_opportunities() - –∫–∞–∂–¥—ã–µ 180 —Å–µ–∫—É–Ω–¥
   ‚îú‚îÄ –ü–æ–ª—É—á–∏—Ç—å —Å–∏–º–≤–æ–ª—ã (PriceFetcher.get_all_symbols)
   ‚îú‚îÄ –§–∏–ª—å—Ç—Ä blacklist
   ‚îú‚îÄ –ü–æ–ª—É—á–∏—Ç—å orderbooks (batch)
   ‚îú‚îÄ –§–∏–ª—å—Ç—Ä –ø–æ —Å–ø—Ä–µ–¥—É (SpreadAnalyzer)
   ‚îú‚îÄ –ü–æ–ª—É—á–∏—Ç—å funding rates (batch)
   ‚îú‚îÄ –ù–∞–π—Ç–∏ —Ç–æ–ø –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (ArbitrageCalculator)
   ‚îî‚îÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Ç–æ–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è
       ‚Üì
4. try_open_position(crypto) - –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
   ‚îú‚îÄ OpportunityMonitor.monitor_and_execute()
   ‚îú‚îÄ –û–∂–∏–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –≤—Ö–æ–¥–∞
   ‚îú‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–µ—á–∞
   ‚îú‚îÄ –û—Ç–∫—Ä—ã—Ç–∏–µ –§–¨–Æ–ß–ï–†–°–ê
   ‚îú‚îÄ –û—Ç–∫—Ä—ã—Ç–∏–µ –°–ü–û–¢–ê
   ‚îî‚îÄ position_manager.save_position()
       ‚Üì
5. monitor_position(crypto) - daemon thread
   ‚îú‚îÄ –¶–∏–∫–ª –∫–∞–∂–¥—ã–µ 300 —Å–µ–∫—É–Ω–¥
   ‚îú‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ funding rate
   ‚îú‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ orderbook
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∑–∞–∫—Ä—ã—Ç–∏—è
   ‚îî‚îÄ –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:
       ‚îú‚îÄ PositionCloser.close_position()
       ‚îî‚îÄ position_manager.close_position_with_pnl()
           ‚îú‚îÄ RealizedFundingCalculator.get_accumulated_funding()
           ‚îú‚îÄ PnLCalculator.calculate_pnl()
           ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏

```
–°—Ü–µ–Ω–∞—Ä–∏–π 1: –§—å—é—á–µ—Ä—Å –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è
‚îú‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ error_code
‚îî‚îÄ –ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π ‚Üí blacklist_manager.add_to_blacklist()

–°—Ü–µ–Ω–∞—Ä–∏–π 2: –§—å—é—á–µ—Ä—Å –æ—Ç–∫—Ä—ã—Ç, —Å–ø–æ—Ç –ù–ï –æ—Ç–∫—Ä—ã—Ç (–ö–†–ò–¢–ò–ß–ù–û!)
‚îú‚îÄ logger.critical("–ù–ï–û–ë–•–û–î–ò–ú–û –í–†–£–ß–ù–£–Æ –ó–ê–ö–†–´–¢–¨ –§–¨–Æ–ß–ï–†–°")
‚îú‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ qty –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
‚îî‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ blacklist (–µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–¥)
```

### 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

```
1. Orchestrator.__init__()
   ‚Üì
2. MultiPositionManager.__init__()
   ‚îú‚îÄ load_all_positions()
   ‚îî‚îÄ –ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö JSON –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ positions/
       ‚Üì
3. Orchestrator.restore_monitoring()
   ‚îú‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
   ‚îî‚îÄ –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏:
       ‚îú‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤—Ö–æ–¥–∞
       ‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ active_threads
       ‚îî‚îÄ –ó–∞–ø—É—Å–∫ monitor_position() –≤ daemon thread
```

## Rate Limiting —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### Batch –∑–∞–ø—Ä–æ—Å—ã
```python
# –í–º–µ—Å—Ç–æ N –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
for symbol in symbols:
    get_orderbook(symbol)  # BAD: N requests

# –ò—Å–ø–æ–ª—å–∑—É–µ–º batch:
get_orderbook_batch(symbols)  # GOOD: 1 request —á–µ—Ä–µ–∑ tickers
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ** (–æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π): –Ω–µ –∂–¥—É—Ç
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π): –º–æ–≥—É—Ç –∂–¥–∞—Ç—å –¥–æ 5 —Å–µ–∫—É–Ω–¥
3. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** (–ø–æ–∏—Å–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π): –∂–¥—É—Ç –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### Retry –ª–æ–≥–∏–∫–∞ –≤ BybitAPIClient
```
–ü–æ–ø—ã—Ç–∫–∞ 1: –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
–ü–æ–ø—ã—Ç–∫–∞ 2: +1 —Å–µ–∫—É–Ω–¥–∞
–ü–æ–ø—ã—Ç–∫–∞ 3: +2 —Å–µ–∫—É–Ω–¥—ã

HTTP 429 ‚Üí –∂–¥–µ–º Retry-After header
retCode 10006 ‚Üí –∂–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É
Timeout ‚Üí —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### Thread Safety –≥–∞—Ä–∞–Ω—Ç–∏–∏
- `MultiPositionManager`: RLock –Ω–∞ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å `self.positions`
- `BlacklistManager`: RLock + Singleton pattern
- `Orchestrator.active_threads`: threading.Lock –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
1. **–ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ blacklist
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –æ—Ç–∫—Ä—ã—Ç–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø–æ–∑–∏—Ü–∏–π

2. **–ü–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (—Å–ø–æ—Ç)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ qty (—Ñ—å—é—á–µ—Ä—Å)

### –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
- Atomic write: `json.dump()` + `os.makedirs(exist_ok=True)`
- –í—Å–µ —Ñ–∞–π–ª—ã UTF-8 encoded
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: append-only –≤ `closed_positions_history.json`

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```python
# –í –ª–æ–≥–∞—Ö:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π / MAX_CONCURRENT_POSITIONS
- Blacklist —Ä–∞–∑–º–µ—Ä –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–∫—Ä—ã—Ç–∏–µ, –∑–∞–∫—Ä—ã—Ç–∏–µ)
- Rate limit —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (requests/sec, weight/sec)
```

### Debug —Ä–µ–∂–∏–º
```python
# –í logger_config.py:
logging.basicConfig(level=logging.DEBUG)  # –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏

# –í main.py:
if __name__ == "__main__":
    orchestrator = MultiCryptoOrchestrator()
    orchestrator.run()
```

### –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
```python
# –ß—Ç–µ–Ω–∏–µ closed_positions_history.json:
import json
with open("positions/closed_positions_history.json") as f:
    history = json.load(f)

# –ê–Ω–∞–ª–∏–∑ PnL:
total_pnl = sum(pos['pnl']['net_pnl'] for pos in history)
avg_pnl = total_pnl / len(history)
win_rate = sum(1 for pos in history if pos['pnl']['net_pnl'] > 0) / len(history)
```

## Deployment

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
```
Python 3.9+
requests
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```env
# Bybit API
BYBIT_API_KEY=your_api_key
BYBIT_API_SECRET=your_api_secret

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è VPS —Å –Ω–µ—Ç–æ—á–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º)
USE_SERVER_TIME=true
```

### –ó–∞–ø—É—Å–∫
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install requests

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python main.py
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (tmux)
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
tmux new -s arbitrage

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python main.py

# –û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è: Ctrl+B, –∑–∞—Ç–µ–º D
# –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ: tmux attach -t arbitrage
```

## Roadmap & Known Issues

### TODO
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ JSON (SQLite/PostgreSQL)
- [ ] Telegram –±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] Web dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (FastAPI + React)
- [ ] Unit-—Ç–µ—Å—Ç—ã (pytest)
- [ ] Backtesting –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –±–∏—Ä–∂ (Binance, OKX)

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ú–∞–∫—Å–∏–º—É–º 1 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤ config)
- Bybit rate limits: 120 req/sec, 600 weight/sec (–∏—Å–ø–æ–ª—å–∑—É–µ–º 50 –∏ 300)
- Funding rate –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤ (00:00, 08:00, 16:00 UTC)
- JSON —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (–º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ë–î)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **–ù–ï –∏–∑–º–µ–Ω—è—Ç—å** –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è (—Å–Ω–∞—á–∞–ª–∞ —Ñ—å—é—á–µ—Ä—Å, –ø–æ—Ç–æ–º —Å–ø–æ—Ç)
- **–ù–ï –∏–∑–º–µ–Ω—è—Ç—å** –ª–æ–≥–∏–∫—É RLock –≤ MultiPositionManager (deadlock —Ä–∏—Å–∫)
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π —Å PnL
- –ü—Ä–æ–≤–µ—Ä–∫–∏ blacklist **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ—Ç–∫—Ä—ã—Ç–∏–µ–º

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –≤ blacklist –≤—Ä—É—á–Ω—É—é
```python
from blacklist_manager import blacklist_manager

blacklist_manager.add_to_blacklist(
    crypto="LUNA",
    reason="Manual blacklist: delisting announcement",
    error_code=None
)
```

### –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ blacklist
```python
blacklist_manager.remove_from_blacklist("LUNA")
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ PnL
```python
from position_manager import MultiPositionManager
import json

manager = MultiPositionManager()
with open("positions/closed_positions_history.json") as f:
    history = json.load(f)

for pos in history[-10:]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
    print(f"{pos['crypto']}: {pos['pnl']['net_pnl']:+.4f} USDT")
```

## FAQ

### –ü–æ—á–µ–º—É —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ—å—é—á–µ—Ä—Å, –∞ –Ω–µ —Å–ø–æ—Ç?

–§—å—é—á–µ—Ä—Å –∫—Ä–∏—Ç–∏—á–Ω–µ–µ –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞:
- –ï—Å–ª–∏ —Å–ø–æ—Ç –Ω–µ –∫—É–ø–∏—Ç—Å—è, –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å —Ñ—å—é—á–µ—Ä—Å –±–µ–∑ —É–±—ã—Ç–∫–∞
- –ï—Å–ª–∏ —Ñ—å—é—á–µ—Ä—Å –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —Å–ø–æ—Ç–∞, –±—É–¥–µ–º –¥–µ—Ä–∂–∞—Ç—å —Å–ø–æ—Ç —Å —Ä–∏—Å–∫–æ–º –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏?

```python
# config.py
TRADE_AMOUNT_USD = 50.0  # –ë—ã–ª–æ 30.0
```

### –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π?

```python
# config.py
MAX_CONCURRENT_POSITIONS = 3  # –ë—ã–ª–æ 1
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞ USDT –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ rate limits!

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –±–æ—Ç —É–ø–∞–ª?

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: `python main.py`
2. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π –∏–∑ `positions/*.json`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 3.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –Ø–Ω–≤–∞—Ä—å 2026  
**–ê–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞**: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä  
**Exchange**: Bybit  
**Strategy**: Spot-Futures Arbitrage (Cash & Carry)
