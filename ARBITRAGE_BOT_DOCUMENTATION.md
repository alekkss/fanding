# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π –±–æ—Ç –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–π –±–∏—Ä–∂–∏ Bybit. –°–∏—Å—Ç–µ–º–∞ —Ç–æ—Ä–≥—É–µ—Ç –∞—Ä–±–∏—Ç—Ä–∞–∂–µ–º –º–µ–∂–¥—É —Å–ø–æ—Ç –∏ —Ñ—å—é—á–µ—Ä—Å–Ω—ã–º–∏ —Ä—ã–Ω–∫–∞–º–∏, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—è –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º funding rate –∏ —Å–ø—Ä–µ–¥–∞—Ö —Ü–µ–Ω. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é —Ü–µ–ª–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π.

**üÜï –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø**: –°–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–ø–æ–∫ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Å–ø—Ä–µ–¥–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Exchange**: Bybit API v5
- **Strategy**: Spot-Futures Arbitrage (Cash & Carry) + Pyramiding
- **Concurrency**: Threading + ThreadPoolExecutor
- **Rate Limiting**: Token Bucket Algorithm
- **Storage**: SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy ORM)
- **Migrations**: Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π –ë–î
- **Design Pattern**: Repository Pattern + Dependency Injection
- **Notifications**: Telegram Bot (python-telegram-bot v20+)
- **Logging**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—Ä–æ–≤–Ω—è–º–∏

## üÜï –°–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–ø–æ–∫ –ø–æ–∑–∏—Ü–∏–π (Position Pyramiding)

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥** - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ —Å–ø—Ä–µ–¥–∞. –ö–æ–≥–¥–∞ —Å–ø—Ä–µ–¥ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ +0.15% –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–∫—É–ø–∞–µ—Ç —Ç–∞–∫–æ–π –∂–µ –æ–±—ä–µ–º, —É—Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω—É –≤—Ö–æ–¥–∞.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏**: –ë–æ–ª—å—à–µ –æ–±—ä–µ–º –ø—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ —Å–ø—Ä–µ–¥–∞ = –±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª–∏ –ø—Ä–∏ —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–∏
- **–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã**: Weighted average entry price –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ PnL
- **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–∏—Å–∫**: –ú–∞–∫—Å–∏–º—É–º 3 –¥–æ–∫—É–ø–∫–∏ + cooldown –º–µ–∂–¥—É –≤—Ö–æ–¥–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```
–í—Ö–æ–¥ 1 (–Ω–∞—á–∞–ª—å–Ω—ã–π): –°–ø—Ä–µ–¥ 0.45%
  ‚Üì –°–ø—Ä–µ–¥ –≤—ã—Ä–æ—Å –¥–æ 0.60% (+0.15%)
–î–æ–∫—É–ø–∫–∞ 1: –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞, total_entries = 2
  ‚Üì –°–ø—Ä–µ–¥ –≤—ã—Ä–æ—Å –¥–æ 0.75% (+0.15%)
–î–æ–∫—É–ø–∫–∞ 2: –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞, total_entries = 3
  ‚Üì –°–ø—Ä–µ–¥ –≤—ã—Ä–æ—Å –¥–æ 0.90% (+0.15%)
–î–æ–∫—É–ø–∫–∞ 3: –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞, total_entries = 4 (–ª–∏–º–∏—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç)
```

### –£—Å–ª–æ–≤–∏—è –¥–æ–∫—É–ø–∫–∏

1. **–†–æ—Å—Ç —Å–ø—Ä–µ–¥–∞**: –¢–µ–∫—É—â–∏–π —Å–ø—Ä–µ–¥ >= –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ø—Ä–µ–¥ + 0.15%
2. **Cooldown**: –ü—Ä–æ—à–ª–æ –º–∏–Ω–∏–º—É–º 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫) —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥–æ–∫—É–ø–∫–∏
3. **–õ–∏–º–∏—Ç –≤—Ö–æ–¥–æ–≤**: –ú–∞–∫—Å–∏–º—É–º 3 –¥–æ–∫—É–ø–∫–∏ (–∏—Ç–æ–≥–æ 4 –≤—Ö–æ–¥–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é)
4. **–ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–∫–∞ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞

### –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ü–µ–Ω (Weighted Average)

```python
# –§–æ—Ä–º—É–ª–∞ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
new_avg_price = (old_avg_price * old_qty + new_price * new_qty) / (old_qty + new_qty)

# –ü—Ä–∏–º–µ—Ä
–í—Ö–æ–¥ 1: –¶–µ–Ω–∞ 100 USDT, qty 10 ‚Üí avg = 100
–î–æ–∫—É–ø–∫–∞ 1: –¶–µ–Ω–∞ 102 USDT, qty 10 ‚Üí avg = (100*10 + 102*10) / 20 = 101
–î–æ–∫—É–ø–∫–∞ 2: –¶–µ–Ω–∞ 104 USDT, qty 10 ‚Üí avg = (101*20 + 104*10) / 30 = 102
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–ø–æ–∫

```
OpportunityMonitor.monitor_open_position_single()
    ‚Üì –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫
    ‚Üì
OpportunityMonitor.monitor_additional_buys()  (daemon thread)
    ‚Üì –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è
    ‚Üì
    ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–∑–∏—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
    ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –¥–æ–∫—É–ø–æ–∫?
    ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: cooldown –∏—Å—Ç–µ–∫?
    ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–ø—Ä–µ–¥ –≤—ã—Ä–æ—Å –Ω–∞ +0.15%?
    ‚Üì
    ‚îú‚îÄ –®–ê–ì 1: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ—å—é—á–µ—Ä—Å–∞ (SHORT)
    ‚îú‚îÄ –®–ê–ì 2: –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–ø–æ—Ç–∞ (LONG)
    ‚Üì
PositionManager.add_to_position()
    ‚Üì –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ü–µ–Ω weighted average
    ‚Üì –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ qty (—Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ)
    ‚Üì –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (total_entries, last_addition_timestamp)
    ‚Üì
PositionRepository.update_position()
    ‚Üì –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
```

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ Position Model

```python
class Position(Base):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...

    # üÜï –ü–æ–ª—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–ø–æ–∫
    total_entries = Column(Integer, default=1)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤ (1 = –Ω–∞—á–∞–ª—å–Ω—ã–π, 2+ = —Å –¥–æ–∫—É–ø–∫–∞–º–∏)
    average_spot_entry_price = Column(Float, nullable=True)  # –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ —Å–ø–æ—Ç–∞
    average_futures_entry_price = Column(Float, nullable=True)  # –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ —Ñ—å—é—á–µ—Ä—Å–∞
    last_addition_timestamp = Column(DateTime, nullable=True)  # –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥–æ–∫—É–ø–∫–∏ (–¥–ª—è cooldown)
    last_entry_spread_pct = Column(Float, nullable=True)  # –°–ø—Ä–µ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞ (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ +0.15%)
```

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ PositionManager

#### `add_to_position()`

```python
def add_to_position(
    self,
    crypto: str,
    new_spot_price: float,
    new_futures_price: float,
    new_spot_qty: float,
    new_futures_qty: float,
    new_spread_pct: float
) -> bool:
    """
    –î–æ–∫—É–ø–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ —Å —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ–º —Ü–µ–Ω.

    Args:
        crypto: –°–∏–º–≤–æ–ª –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
        new_spot_price: –¶–µ–Ω–∞ –Ω–æ–≤–æ–≥–æ —Å–ø–æ—Ç –≤—Ö–æ–¥–∞
        new_futures_price: –¶–µ–Ω–∞ –Ω–æ–≤–æ–≥–æ —Ñ—å—é—á–µ—Ä—Å –≤—Ö–æ–¥–∞
        new_spot_qty: –î–æ–∫—É–ø–ª–µ–Ω–Ω–æ–µ qty —Å–ø–æ—Ç–∞
        new_futures_qty: –î–æ–∫—É–ø–ª–µ–Ω–Ω–æ–µ qty —Ñ—å—é—á–µ—Ä—Å–∞
        new_spread_pct: –°–ø—Ä–µ–¥ –ø—Ä–∏ –¥–æ–∫—É–ø–∫–µ

    Returns:
        bool: True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ

    –î–µ–π—Å—Ç–≤–∏—è:
        1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã (weighted average)
        3. –°—É–º–º–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        4. –û–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–ø–æ–∫
        5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    """
```

**–§–æ—Ä–º—É–ª–∞ weighted average:**
```python
new_avg_spot = (old_avg * old_qty + new_price * new_qty) / (old_qty + new_qty)
new_avg_futures = (old_avg * old_qty + new_price * new_qty) / (old_qty + new_qty)
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Telegram

#### –ö–æ–º–∞–Ω–¥–∞ `/positions`

```
üìç –û–¢–ö–†–´–¢–´–ï –ü–û–ó–ò–¶–ò–ò (1)

1. BTC
‚îú‚îÄ –í—Ö–æ–¥: 07.01 16:05 (2—á 15–º–∏–Ω –Ω–∞–∑–∞–¥)
‚îú‚îÄ üî¢ –í—Ö–æ–¥–æ–≤: 3
‚îú‚îÄ üìä –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã:
‚îÇ   ‚îú‚îÄ –°–ø–æ—Ç: 45150.234567 USDT
‚îÇ   ‚îî‚îÄ –§—å—é—á: 45350.123456 USDT
‚îú‚îÄ –°–ø–æ—Ç qty: 0.066
‚îú‚îÄ –§—å—é—á–µ—Ä—Å qty: 0.065
‚îî‚îÄ –°–ø—Ä–µ–¥: 0.75%
```

#### –ö–æ–º–∞–Ω–¥–∞ `/history`

```
üìú –ò–°–¢–û–†–ò–Ø –ó–ê–ö–†–´–¢–´–• –ü–û–ó–ò–¶–ò–ô

1. BTC
‚úÖ –ü—Ä–∏–±—ã–ª—å: +2.45 USDT
üìä –í—Ö–æ–¥–æ–≤: 3
‚îú‚îÄ –í—Ö–æ–¥: 07.01 16:05
‚îú‚îÄ –ó–∞–∫—Ä—ã—Ç–∏–µ: 07.01 19:20
‚îú‚îÄ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3—á 15–º–∏–Ω
‚îú‚îÄ –°–ø—Ä–µ–¥ –≤—Ö–æ–¥–∞: 0.75%
‚îî‚îÄ PnL: Spot +1.20 | Fut +0.80 | FR +0.65 | Comm -0.20
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/
‚îú‚îÄ‚îÄ main.py                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–∑–∞–ø—É—Å–∫–∞–µ—Ç orchestrator)
‚îú‚îÄ‚îÄ .env                             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (API –∫–ª—é—á–∏ Bybit + Telegram)
‚îú‚îÄ‚îÄ arbitrage.db                     # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ orchestrator.py                  # –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ config.py                        # –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ /database/                       # –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ database.py                  # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î, SQLAlchemy engine, session
‚îÇ   ‚îú‚îÄ‚îÄ models.py                    # üÜï SQLAlchemy –º–æ–¥–µ–ª–∏ (—Å –ø–æ–ª—è–º–∏ –¥–æ–∫—É–ø–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ /repositories/               # Repository Pattern –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ base_repository.py       # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ       ‚îú‚îÄ‚îÄ position_repository.py   # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
‚îÇ       ‚îú‚îÄ‚îÄ history_repository.py    # –†–∞–±–æ—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
‚îÇ       ‚îî‚îÄ‚îÄ blacklist_repository.py  # –†–∞–±–æ—Ç–∞ —Å blacklist
‚îÇ
‚îú‚îÄ‚îÄ /migrations/                     # Alembic –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ env.py                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îÇ   ‚îú‚îÄ‚îÄ script.py.mako               # –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini                  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Alembic
‚îÇ   ‚îî‚îÄ‚îÄ /versions/                   # –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ       ‚îî‚îÄ‚îÄ xxx_initial_schema.py
‚îÇ
‚îú‚îÄ‚îÄ /scripts/                        # –£—Ç–∏–ª–∏—Ç—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ migrate_blacklist_to_db.py   # –ú–∏–≥—Ä–∞—Ü–∏—è blacklist.json ‚Üí –ë–î (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π)
‚îÇ
‚îú‚îÄ‚îÄ /telegram_bot/                   # Telegram –±–æ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ bot.py                       # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å TelegramBot (lifecycle management)
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py                  # üÜï Command handlers (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–æ–∫—É–ø–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ formatters.py                # üÜï Message formatters (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–ø–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ notifications.py             # Notification service (–æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
‚îÇ   ‚îî‚îÄ‚îÄ config.py                    # Telegram –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω, admin chat_ids)
‚îÇ
‚îú‚îÄ‚îÄ /integration/                    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ telegram_integration.py      # TelegramIntegration (singleton –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É)
‚îÇ
‚îú‚îÄ‚îÄ /api/
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py                # –ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç Bybit API (GET/POST —Å retry)
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                      # API –∫–ª—é—á–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ HMAC
‚îÇ   ‚îî‚îÄ‚îÄ rate_limiter.py              # Rate limiting (requests/sec, weight/sec)
‚îÇ
‚îú‚îÄ‚îÄ /services/
‚îÇ   ‚îú‚îÄ‚îÄ price_service.py             # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω (orderbook, ticker)
‚îÇ   ‚îú‚îÄ‚îÄ funding_rate_service.py      # –ü–æ–ª—É—á–µ–Ω–∏–µ funding rates
‚îÇ   ‚îú‚îÄ‚îÄ spread_analyzer.py           # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–ø—Ä–µ–¥–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ arbitrage_calculator.py      # –†–∞—Å—á–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
‚îÇ   ‚îú‚îÄ‚îÄ opportunity_monitor.py       # üÜï –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ + –¥–æ–∫—É–ø–∫–∏ (monitor_additional_buys)
‚îÇ   ‚îî‚îÄ‚îÄ order_executor.py            # –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ (—Å–ø–æ—Ç/—Ñ—å—é—á–µ—Ä—Å)
‚îÇ
‚îú‚îÄ‚îÄ /managers/
‚îÇ   ‚îú‚îÄ‚îÄ position_manager.py          # üÜï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏ + add_to_position()
‚îÇ   ‚îú‚îÄ‚îÄ blacklist_manager.py         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ blacklist —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (DI)
‚îÇ   ‚îú‚îÄ‚îÄ leverage_manager.py          # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–µ—á–∞
‚îÇ   ‚îî‚îÄ‚îÄ balance.py                   # –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ /calculators/
‚îÇ   ‚îú‚îÄ‚îÄ pnl_calculator.py            # –†–∞—Å—á–µ—Ç PnL –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ funding_calculator.py        # –†–∞—Å—á–µ—Ç –†–ï–ê–õ–¨–ù–û–ì–û —Ñ–∞–Ω–¥–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ API
‚îÇ
‚îî‚îÄ‚îÄ /utils/
    ‚îú‚îÄ‚îÄ logger_config.py             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îî‚îÄ‚îÄ utils.py                     # –£—Ç–∏–ª–∏—Ç—ã (timestamp –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞)
```

## –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Database Layer (database/)

**–°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Repository Pattern**

#### database.py
- –°–æ–∑–¥–∞–Ω–∏–µ SQLAlchemy engine –∏ session factory
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (`check_db_connection()`)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SQLite (WAL mode, foreign keys)

#### models.py - SQLAlchemy –º–æ–¥–µ–ª–∏

```python
class Position(Base):
    __tablename__ = 'positions'
    id = Column(Integer, primary_key=True)
    crypto = Column(String(20), unique=True, index=True)
    spot_entry_price = Column(Float)
    futures_entry_price = Column(Float)
    spot_qty = Column(Float)
    futures_qty = Column(Float)
    entry_spread_pct = Column(Float)
    entry_timestamp = Column(DateTime)
    funding_payments_count = Column(Integer, default=0)
    low_fr_count = Column(Integer, default=0)
    consecutive_low_fr = Column(Boolean, default=False)

    # üÜï –ü–æ–ª—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–ø–æ–∫
    total_entries = Column(Integer, default=1)
    average_spot_entry_price = Column(Float, nullable=True)
    average_futures_entry_price = Column(Float, nullable=True)
    last_addition_timestamp = Column(DateTime, nullable=True)
    last_entry_spread_pct = Column(Float, nullable=True)

class ClosedPosition(Base):
    __tablename__ = 'closed_positions'
    id = Column(Integer, primary_key=True)
    crypto = Column(String(20), index=True)
    entry_timestamp = Column(DateTime)
    close_timestamp = Column(DateTime, index=True)
    net_pnl = Column(Float)
    funding_pnl = Column(Float)

    # üÜï –ü–æ–ª—è –¥–ª—è –¥–æ–∫—É–ø–æ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏
    total_entries = Column(Integer, default=1)
    average_spot_entry_price = Column(Float, nullable=True)
    average_futures_entry_price = Column(Float, nullable=True)
    # ...

class Blacklist(Base):
    __tablename__ = 'blacklist'
    id = Column(Integer, primary_key=True)
    crypto = Column(String(20), unique=True, index=True)
    reason = Column(Text)
    error_code = Column(Integer, nullable=True)
    timestamp = Column(DateTime)
    # ...
```

#### Repositories - –ø–∞—Ç—Ç–µ—Ä–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

**PositionRepository** (`position_repository.py`)
- `create_position()` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
- `get_by_crypto()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Å–∏–º–≤–æ–ª—É
- `has_position()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
- `get_all_open()` - –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- `increment_funding_count()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ñ–∞–Ω–¥–∏–Ω–≥–∞
- `delete_by_crypto()` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- `update_position()` - üÜï –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π –ø–æ–∑–∏—Ü–∏–∏ (–¥–ª—è –¥–æ–∫—É–ø–æ–∫)

**HistoryRepository** (`history_repository.py`)
- `save_closed_position()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ (—Å –ø–æ–ª—è–º–∏ –¥–æ–∫—É–ø–æ–∫)
- `get_all_history()` - –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è
- `get_history_by_crypto()` - –∏—Å—Ç–æ—Ä–∏—è –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–µ
- `get_recent_history()` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- `get_statistics()` / `calculate_statistics()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (total PnL, win rate, avg PnL)

**BlacklistRepository** (`blacklist_repository.py`)
- `add_to_blacklist()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ blacklist
- `is_blacklisted()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è
- `remove_from_blacklist()` - —É–¥–∞–ª–µ–Ω–∏–µ
- `get_all_blacklisted()` - –≤—Å–µ –∑–∞–ø–∏—Å–∏ (Set[str])
- `get_all_details()` - –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
- `bulk_add()` - –º–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏)

### 2. Telegram Bot Integration (telegram_bot/)

**–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **bot.py**: –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å `TelegramBot` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –±–æ—Ç–∞
- **handlers.py**: Command handlers - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ (üÜï —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–æ–∫—É–ø–æ–∫)
- **formatters.py**: Message formatters - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Telegram (üÜï –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–ø–æ–∫)
- **notifications.py**: Notification service - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ–±—ã—Ç–∏—è—Ö
- **config.py**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω –±–æ—Ç–∞, admin chat IDs)

#### üÜï –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç–µ—Ä—ã (formatters.py)

**`format_positions_list()`** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å –¥–æ–∫—É–ø–∫–∞–º–∏

```python
def format_positions_list(positions: List[Dict[str, Any]]) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

    üÜï –ù–û–í–û–ï: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ–∫—É–ø–∫–∞—Ö
    - total_entries: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤
    - average_spot_entry_price: —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ —Å–ø–æ—Ç–∞
    - average_futures_entry_price: —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ —Ñ—å—é—á–µ—Ä—Å–∞
    """
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç total_entries
    if total_entries > 1:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–í—Ö–æ–¥–æ–≤: 3"
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã
    else:
        # –û–±—ã—á–Ω—ã–π –≤–∏–¥ –±–µ–∑ –¥–æ–∫—É–ø–æ–∫
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üìç –û–¢–ö–†–´–¢–´–ï –ü–û–ó–ò–¶–ò–ò (1)

1. BTC
‚îú‚îÄ –í—Ö–æ–¥: 07.01 16:05 (2—á 15–º–∏–Ω –Ω–∞–∑–∞–¥)
‚îú‚îÄ üî¢ –í—Ö–æ–¥–æ–≤: 3
‚îú‚îÄ üìä –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã:
‚îÇ   ‚îú‚îÄ –°–ø–æ—Ç: 45150.234567 USDT
‚îÇ   ‚îî‚îÄ –§—å—é—á: 45350.123456 USDT
‚îú‚îÄ –°–ø–æ—Ç qty: 0.066
‚îú‚îÄ –§—å—é—á–µ—Ä—Å qty: 0.065
‚îî‚îÄ –°–ø—Ä–µ–¥: 0.75%
```

### 3. MultiCryptoOrchestrator (orchestrator.py)

**–ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Å Dependency Injection**

*(–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π - —Å–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–ø–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ –ø–æ—Ç–æ–∫–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)*

### 4. OpportunityMonitor (opportunity_monitor.py)

**üÜï –õ–æ–≥–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–æ–∫—É–ø–æ–∫**

#### –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (`monitor_and_execute`)
```
–£—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞:
1. spread_pct >= 0.45%   (MIN_ENTRY_SPREAD_PCT)
2. funding_rate >= 0.02% (MIN_FUNDING_RATE)

–ü–æ—Ä—è–¥–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:
1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–µ—á–∞ (LEVERAGE = 1)
2Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç–∏–µ –§–¨–Æ–ß–ï–†–°–ê (SHORT)  ‚Üê –°–ù–ê–ß–ê–õ–ê!
3Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç–∏–µ –°–ü–û–¢–ê (LONG)
   ‚ö†Ô∏è –ï—Å–ª–∏ —Å–ø–æ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è ‚Üí –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø ‚Üí Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
4Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —á–µ—Ä–µ–∑ position_manager.save_position()
5Ô∏è‚É£ üÜï –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ –¥–æ–∫—É–ø–æ–∫ (–µ—Å–ª–∏ ENABLE_POSITION_ADDITIONS = True)
6Ô∏è‚É£ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
```

#### üÜï –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ–∫—É–ø–æ–∫ (`monitor_additional_buys`)

```python
@staticmethod
def monitor_additional_buys(crypto: str, position_manager) -> None:
    """
    –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ–∫—É–ø–æ–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏.

    –£–°–õ–û–í–ò–Ø –î–û–ö–£–ü–ö–ò:
    - –°–ø—Ä–µ–¥ –≤—ã—Ä–æ—Å –Ω–∞ +0.15% –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
    - –ü—Ä–æ—à–ª–æ –º–∏–Ω–∏–º—É–º 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫) —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥–æ–∫—É–ø–∫–∏
    - –ú–∞–∫—Å–∏–º—É–º 3 –¥–æ–∫—É–ø–∫–∏ (–∏—Ç–æ–≥–æ 4 –≤—Ö–æ–¥–∞)

    –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º daemon thread:
    - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ monitor_open_position_single()
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫)
    - –ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –∏–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç

    –ü–æ—Ä—è–¥–æ–∫ –¥–æ–∫—É–ø–∫–∏:
    1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (total_entries <= MAX_POSITION_ADDITIONS)
    3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ cooldown (300 —Å–µ–∫ —Å last_addition_timestamp)
    4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø—Ä–µ–¥–∞ (current >= last + 0.15%)
    5Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ—å—é—á–µ—Ä—Å–∞ (SHORT)
    6Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–ø–æ—Ç–∞ (LONG)
    7Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ add_to_position()
    """
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:**
```
[BTC] üîÑ –ó–∞–ø—É—â–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ–∫—É–ø–æ–∫ (–º–∞–∫—Å. 3 –¥–æ–∫—É–ø–æ–∫)
[BTC] [–ü–æ–ø—ã—Ç–∫–∞ 12] –í—Ö–æ–¥ #1: –¢–µ–∫—É—â–∏–π —Å–ø—Ä–µ–¥ 0.58%, –¶–µ–ª–µ–≤–æ–π 0.60% (+0.15%)
[BTC] ========================================
[BTC] üéØ –£–°–õ–û–í–ò–Ø –î–û–ö–£–ü–ö–ò –í–´–ü–û–õ–ù–ï–ù–´!
[BTC] –í—Ö–æ–¥ #2
[BTC] –¢–µ–∫—É—â–∏–π —Å–ø—Ä–µ–¥: 0.62% >= 0.60%
[BTC] –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥ –±—ã–ª –ø—Ä–∏ —Å–ø—Ä–µ–¥–µ: 0.45%
[BTC] ========================================
[BTC] üìç –®–ê–ì 1/2: –î–æ–∫—É–ø–∫–∞ –§–¨–Æ–ß–ï–†–°...
[BTC] ‚úÖ –§—å—é—á–µ—Ä—Å –¥–æ–∫—É–ø–ª–µ–Ω: OrderID 12345
[BTC] üìç –®–ê–ì 2/2: –î–æ–∫—É–ø–∫–∞ –°–ü–û–¢...
[BTC] ‚úÖ –°–ø–æ—Ç –¥–æ–∫—É–ø–ª–µ–Ω: OrderID 67890
[BTC] ‚úÖ –î–æ–∫—É–ø–∫–∞ #1 —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞
[BTC] Cooldown –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ 300 —Å–µ–∫—É–Ω–¥
```

#### –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (`monitor_open_position_single`)

```
üÜï –ò–ó–ú–ï–ù–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ PnL

–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º:
- FR < -0.001% (CLOSE_FR_THRESHOLD)
- –°–ø—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏—è <= 0.15% (MAX_CLOSE_SPREAD_PCT)

–ú—è–≥–∫–∏–π —Ä–µ–∂–∏–º (–ø–æ—Å–ª–µ 15+ —Ä–∞—É–Ω–¥–æ–≤ —Å FR <= 0.005%):
- FR <= 0.005% (LOW_FR_TRACKING_THRESHOLD)
- –°–ø—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏—è <= 0.15%

–ü–æ—Ä—è–¥–æ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è:
1Ô∏è‚É£ –ü—Ä–æ–¥–∞–∂–∞ –°–ü–û–¢–ê (–ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –±–∞–ª–∞–Ω—Å—É)
2Ô∏è‚É£ –ü–æ–∫—É–ø–∫–∞ –§–¨–Æ–ß–ï–†–°–ê (–ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É qty)
3Ô∏è‚É£ –†–∞—Å—á–µ—Ç PnL —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º average_entry_prices
4Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é —á–µ—Ä–µ–∑ history_repo.save_closed_position()
5Ô∏è‚É£ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å PnL
```

### 5. MultiPositionManager (position_manager.py)

**üÜï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–æ–∫—É–ø–æ–∫**

#### –ù–æ–≤—ã–π –º–µ—Ç–æ–¥: `add_to_position()`

```python
@synchronized_save
def add_to_position(
    self,
    crypto: str,
    new_spot_price: float,
    new_futures_price: float,
    new_spot_qty: float,
    new_futures_qty: float,
    new_spread_pct: float
) -> bool:
    """
    –î–æ–∫—É–ø–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ —Å —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ–º —Ü–µ–Ω.

    Thread-safe: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç @synchronized_save –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä

    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç weighted average –¥–ª—è —Ü–µ–Ω:
       new_avg = (old_avg * old_qty + new_price * new_qty) / (old_qty + new_qty)
    3. –°—É–º–º–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    4. –û–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
       - total_entries += 1
       - last_addition_timestamp = now()
       - last_entry_spread_pct = new_spread_pct
       - average_spot_entry_price = calculated
       - average_futures_entry_price = calculated
    5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ position_repo.update_position()

    Returns:
        bool: True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
    """
```

**–ü—Ä–∏–º–µ—Ä:**
```python
# –í—Ö–æ–¥ 1 (–Ω–∞—á–∞–ª—å–Ω—ã–π)
save_position(
    crypto="BTC",
    spot_price=45000.0,
    spot_qty=0.022,
    futures_price=45200.0,
    futures_qty=0.022,
    spread_pct=0.45
)
# ‚Üí total_entries=1, avg_spot=45000, avg_futures=45200

# –î–æ–∫—É–ø–∫–∞ 1
add_to_position(
    crypto="BTC",
    new_spot_price=45100.0,
    new_spot_qty=0.022,
    new_futures_price=45300.0,
    new_futures_qty=0.022,
    new_spread_pct=0.60
)
# ‚Üí total_entries=2
# ‚Üí avg_spot = (45000*0.022 + 45100*0.022) / 0.044 = 45050
# ‚Üí avg_futures = (45200*0.022 + 45300*0.022) / 0.044 = 45250
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**`save_position()`** - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—è –¥–æ–∫—É–ø–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:
```python
total_entries=1,
average_spot_entry_price=None,  # –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –¥–æ–∫—É–ø–∫–µ
average_futures_entry_price=None,
last_addition_timestamp=None,
last_entry_spread_pct=spot_price  # –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –¥–æ–∫—É–ø–∫–∏
```

**`close_position_with_pnl()`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è PnL:
```python
# –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–∫—É–ø–∫–∏ (total_entries > 1)
entry_spot = position.average_spot_entry_price or position.spot_entry_price
entry_futures = position.average_futures_entry_price or position.futures_entry_price

# –†–∞—Å—á–µ—Ç PnL
pnl_result = PnLCalculator.calculate_pnl(
    entry_spot_price=entry_spot,
    entry_futures_price=entry_futures,
    close_spot_price=close_spot_price,
    close_futures_price=close_futures_price,
    spot_qty=position.spot_qty,
    futures_qty=position.futures_qty,
    funding_pnl=funding_pnl
)
```

### 6. BlacklistManager (blacklist_manager.py)

**Singleton-–º–µ–Ω–µ–¥–∂–µ—Ä —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –ø–∞–º—è—Ç–∏**

*(–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)*

### 7. OrderExecutor (order_executor.py)

**–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞**

*(–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)*

### 8. PnLCalculator (pnl_calculator.py)

**–†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏**

#### üÜï –û–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏

```python
# –§–æ—Ä–º—É–ª–∞ (—Å —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏)
Spot PnL = (exit_price - entry_avg_price) * spot_qty
Futures PnL = (entry_avg_price - exit_price) * futures_qty
Price PnL = Spot PnL + Futures PnL
Commission = (entry_value + exit_value) * commission_rate
Net PnL = Price PnL + Funding - Commission
```

### 9. RealizedFundingCalculator (funding_calculator.py)

**–†–∞—Å—á–µ—Ç –†–ï–ê–õ–¨–ù–û–ì–û –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Bybit API**

*(–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)*

### 10. Rate Limiter (rate_limiter.py)

**Token Bucket –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç rate limit**

*(–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)*

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.py)

### –¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```python
TRADE_AMOUNT_USD = 30.0      # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT
LEVERAGE = 1                 # –ë–µ–∑ –ø–ª–µ—á–∞ (—Ö–µ–¥–∂)
COMMISSION_PCT = 0.27        # –°—É–º–º–∞—Ä–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è (–æ—Ç–∫—Ä—ã—Ç–∏–µ + –∑–∞–∫—Ä—ã—Ç–∏–µ)
```

### –ü–æ—Ä–æ–≥–∏ –≤—Ö–æ–¥–∞
```python
MIN_SPREAD_PCT = 0.0         # –§–∏–ª—å—Ç—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
MIN_ENTRY_SPREAD_PCT = 0.45  # –ü–æ—Ä–æ–≥ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏
MIN_FUNDING_RATE = 0.02      # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π FR –¥–ª—è –≤—Ö–æ–¥–∞ (0.02% = 2 basis points)
```

### –ü–æ—Ä–æ–≥–∏ –≤—ã—Ö–æ–¥–∞
```python
CLOSE_FR_THRESHOLD = -0.001      # –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
LOW_FR_TRACKING_THRESHOLD = 0.01 # –ú—è–≥–∫–∏–π —Ä–µ–∂–∏–º
MIN_FUNDING_PAYMENTS_FOR_CLOSE = 15  # –†–∞—É–Ω–¥–æ–≤ —Å –Ω–∏–∑–∫–∏–º FR –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –º—è–≥–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞
MAX_CLOSE_SPREAD_PCT = 0.15      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
```

### üÜï –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–∫—É–ø–æ–∫ –ø–æ–∑–∏—Ü–∏–π

```python
# ========================================
# üÜï –ù–û–í–û–ï: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–∫—É–ø–∫–∏ –ø–æ–∑–∏—Ü–∏–π
# ========================================

# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–æ–∫—É–ø–æ–∫
ENABLE_POSITION_ADDITIONS = True

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–ø–æ–∫ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é (–Ω–µ –≤–∫–ª—é—á–∞—è –Ω–∞—á–∞–ª—å–Ω—ã–π –≤—Ö–æ–¥)
MAX_POSITION_ADDITIONS = 3  # –ò—Ç–æ–≥–æ: 1 –Ω–∞—á–∞–ª—å–Ω—ã–π + 3 –¥–æ–∫—É–ø–∫–∏ = 4 –≤—Ö–æ–¥–∞

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç —Å–ø—Ä–µ–¥–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –¥–æ–∫—É–ø–∫–∏ (%)
# –ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –≤—Ö–æ–¥ –±—ã–ª –Ω–∞ 0.45%, —Ç–æ –¥–æ–∫—É–ø–∫–∞ –±—É–¥–µ—Ç –Ω–∞ 0.60% (0.45 + 0.15)
ADDITION_SPREAD_INCREMENT = 0.15

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –¥–æ–∫—É–ø–∫–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
ADDITION_COOLDOWN_SEC = 300  # 5 –º–∏–Ω—É—Ç

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π FR –¥–ª—è –¥–æ–∫—É–ø–∫–∏ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0)
MIN_FUNDING_RATE_FOR_ADDITION = 0.0
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç:**

- **`ENABLE_POSITION_ADDITIONS`**: –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–æ–∫—É–ø–æ–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ
- **`MAX_POSITION_ADDITIONS`**: –ú–∞–∫—Å–∏–º—É–º –¥–æ–∫—É–ø–æ–∫ (–Ω–µ —Å—á–∏—Ç–∞—è –Ω–∞—á–∞–ª—å–Ω—ã–π –≤—Ö–æ–¥)
  - `3` –æ–∑–Ω–∞—á–∞–µ—Ç: 1 –Ω–∞—á–∞–ª—å–Ω—ã–π + 3 –¥–æ–∫—É–ø–∫–∏ = –∏—Ç–æ–≥–æ 4 –≤—Ö–æ–¥–∞
- **`ADDITION_SPREAD_INCREMENT`**: –®–∞–≥ —Å–ø—Ä–µ–¥–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –¥–æ–∫—É–ø–∫–∏
  - –í—Ö–æ–¥: 0.45% ‚Üí –î–æ–∫—É–ø–∫–∞ 1: 0.60% ‚Üí –î–æ–∫—É–ø–∫–∞ 2: 0.75% ‚Üí –î–æ–∫—É–ø–∫–∞ 3: 0.90%
- **`ADDITION_COOLDOWN_SEC`**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –¥–æ–∫—É–ø–∫–∞–º–∏
  - `300` = 5 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –¥–æ–∫—É–ø–∫–∞–º–∏
- **`MIN_FUNDING_RATE_FOR_ADDITION`**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π FR –¥–ª—è –¥–æ–∫—É–ø–∫–∏
  - `0.0` = –¥–æ–∫—É–ø–∞–µ–º –ø—Ä–∏ –ª—é–±–æ–º –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º FR

### –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
```python
MAX_CONCURRENT_POSITIONS = 1  # –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
MAX_TRADING_THREADS = 3       # –ü–æ—Ç–æ–∫–æ–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
SCAN_INTERVAL_SEC = 180       # –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä—ã–Ω–∫–∞
MONITOR_INTERVAL_SEC = 300    # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∑–∏—Ü–∏–π
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```python
DATABASE_URL = "sqlite:///./arbitrage.db"  # SQLite —Ñ–∞–π–ª
```

### Telegram Bot (telegram_bot/config.py)
```python
BOT_TOKEN = "your_bot_token_here"
ADMIN_CHAT_IDS = []  # –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π chat_id –ø–æ—Å–ª–µ /start
ENABLE_NOTIFICATIONS = True
MESSAGE_TIMEOUT = 30
```

## Deployment

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
```
Python 3.9+
sqlalchemy>=2.0.0
alembic>=1.13.0
requests
python-telegram-bot==20.7
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
pip install sqlalchemy alembic requests python-telegram-bot==20.7
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```env
# Bybit API
BYBIT_API_KEY=your_api_key
BYBIT_API_SECRET=your_api_secret

# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_here

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
DATABASE_URL=sqlite:///./arbitrage.db

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è VPS —Å –Ω–µ—Ç–æ—á–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º)
USE_SERVER_TIME=true
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ú–∏–≥—Ä–∞—Ü–∏—è blacklist.json ‚Üí –ë–î (–µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)
python scripts/migrate_blacklist_to_db.py
```

### üÜï –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–æ–∫—É–ø–æ–∫

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "add_position_additions_fields"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head
```

**–ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:**
- `total_entries` (Integer, default=1)
- `average_spot_entry_price` (Float, nullable)
- `average_futures_entry_price` (Float, nullable)
- `last_addition_timestamp` (DateTime, nullable)
- `last_entry_spread_pct` (Float, nullable)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
1. –ù–∞–ø–∏—Å–∞—Ç—å @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/newbot`
3. –£–∫–∞–∑–∞—Ç—å –∏–º—è –±–æ—Ç–∞
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ chat_id
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: `python main.py`
2. –ù–∞–ø–∏—Å–∞—Ç—å `/start` —Å–≤–æ–µ–º—É –±–æ—Ç—É –≤ Telegram
3. –í –ª–æ–≥–∞—Ö —É–≤–∏–¥–µ—Ç—å:
   ```
   [TELEGRAM] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 123456789 (@username) –æ—Ç–ø—Ä–∞–≤–∏–ª /start
   ```
4. –û—Ç–∫—Ä—ã—Ç—å `telegram_bot/config.py`
5. –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π chat_id:
   ```python
   ADMIN_CHAT_IDS = [123456789]
   ```
6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```
/start     - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
/status    - –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
/positions - –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (üÜï —Å –¥–æ–∫—É–ø–∫–∞–º–∏)
/stats     - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
/history   - üÜï –ò—Å—Ç–æ—Ä–∏—è —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤—Ö–æ–¥–æ–≤
```

### –ó–∞–ø—É—Å–∫
```bash
python main.py
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
2026-01-07 20:00:00 - INFO - üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞...
2026-01-07 20:00:00 - INFO - ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å–ø–µ—à–Ω–æ
2026-01-07 20:00:00 - INFO - ‚úÖ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
2026-01-07 20:00:00 - INFO - ‚úÖ Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
2026-01-07 20:00:00 - INFO - üöÄ –ó–∞–ø—É—Å–∫ Telegram Bot polling...
2026-01-07 20:00:01 - INFO - ‚úÖ Telegram Bot polling –∑–∞–ø—É—â–µ–Ω
2026-01-07 20:00:01 - INFO - [BTC] üîÑ –ó–∞–ø—É—â–µ–Ω –ø–æ—Ç–æ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ–∫—É–ø–æ–∫
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (tmux)
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
tmux new -s arbitrage

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python main.py

# –û—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è: Ctrl+B, –∑–∞—Ç–µ–º D
# –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ: tmux attach -t arbitrage
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤
```
[2026-01-07 20:00:00] [INFO] üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞...
[2026-01-07 20:00:00] [INFO] ‚úÖ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞
[2026-01-07 20:00:01] [INFO] [BTC] üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–∫—Ä—ã—Ç–∏—è...
[2026-01-07 20:00:01] [INFO] [BTC] üîÑ –ó–∞–ø—É—â–µ–Ω –ø–æ—Ç–æ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ–∫—É–ø–æ–∫
[2026-01-07 20:05:00] [INFO] [BTC] üéØ –£–°–õ–û–í–ò–Ø –î–û–ö–£–ü–ö–ò –í–´–ü–û–õ–ù–ï–ù–´!
[2026-01-07 20:05:01] [INFO] [BTC] ‚úÖ –î–æ–∫—É–ø–∫–∞ #1 —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞
[2026-01-07 20:10:00] [INFO] [BTC] üî• –£—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
[2026-01-07 20:10:01] [INFO] [BTC] ‚úÖ –ü–æ–∑–∏—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞
[2026-01-07 20:10:02] [INFO] üí∞ NET PnL: +2.45 USDT ‚úÖ (3 –≤—Ö–æ–¥–∞)
```

### –£—Ä–æ–≤–Ω–∏
- `DEBUG`: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (API –∑–∞–ø—Ä–æ—Å—ã, SQL queries)
- `INFO`: –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ, –¥–æ–∫—É–ø–∫–∏, Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- `WARNING`: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (timeout, blacklist)
- `ERROR`: –û—à–∏–±–∫–∏ (API failures, –ë–î –ø—Ä–æ–±–ª–µ–º—ã)
- `CRITICAL`: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (—Ñ—å—é—á–µ—Ä—Å –æ—Ç–∫—Ä—ã—Ç, —Å–ø–æ—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç)

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —à—É–º–Ω—ã—Ö –ª–æ–≥–æ–≤
–í `utils/logger_config.py`:
```python
logging.getLogger('httpx').setLevel(logging.WARNING)
logging.getLogger('telegram').setLevel(logging.WARNING)
```

## Roadmap & Known Issues

### Completed ‚úÖ
- [x] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ JSON (SQLite + SQLAlchemy)
- [x] Repository Pattern –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- [x] Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- [x] Dependency Injection –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ã
- [x] –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ blacklist.json ‚Üí –ë–î
- [x] Telegram –±–æ—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [x] Real-time notifications –æ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- [x] Command handlers (/start, /status, /positions, /stats)
- [x] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Ñ—å—é—á–µ—Ä—Å –æ—Ç–∫—Ä—ã—Ç, —Å–ø–æ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è)
- [x] üÜï –°–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–ø–æ–∫ –ø–æ–∑–∏—Ü–∏–π (Position Pyramiding)
- [x] üÜï Weighted average —Ü–µ–Ω –≤—Ö–æ–¥–∞
- [x] üÜï –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–ø–æ–∫ –≤ Telegram (/positions, /history)
- [x] üÜï Parallel thread monitoring –¥–ª—è –¥–æ–∫—É–ø–æ–∫

### TODO
- [ ] Web dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (FastAPI + React)
- [ ] Unit-—Ç–µ—Å—Ç—ã (pytest) —Å mock —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
- [ ] Backtesting –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –±–∏—Ä–∂ (Binance, OKX)
- [ ] PostgreSQL support –¥–ª—è production
- [ ] Telegram –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (/close, /blacklist add/remove)
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ PnL –≤ Telegram
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π increment —Å–ø—Ä–µ–¥–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π 0.15%)
- [ ] –°—Ç–æ–ø-–ª–æ—Å—Å –¥–ª—è –¥–æ–∫—É–ø–æ–∫

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ú–∞–∫—Å–∏–º—É–º 1 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤ config)
- Bybit rate limits: 120 req/sec, 600 weight/sec (–∏—Å–ø–æ–ª—å–∑—É–µ–º 50 –∏ 300)
- Funding rate –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤ (00:00, 08:00, 16:00 UTC)
- SQLite –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (–º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL)
- Telegram –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ daemon thread (–∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞)
- üÜï –°–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–ø–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º FR

## FAQ

### üÜï –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–ø–æ–∫?

**–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç**: –ü—Ä–∏ —Ä–æ—Å—Ç–µ —Å–ø—Ä–µ–¥–∞ –Ω–∞ +0.15% –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–∫—É–ø–∞–µ—Ç —Ç–∞–∫–æ–π –∂–µ –æ–±—ä–µ–º, —É—Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω—É –≤—Ö–æ–¥–∞.

**–ü–æ–¥—Ä–æ–±–Ω–æ**:
1. –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–ø—Ä–µ–¥–µ 0.45%
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ–∫—É–ø–æ–∫
3. –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è: —Å–ø—Ä–µ–¥ >= –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ø—Ä–µ–¥ + 0.15%?
4. –ï—Å–ª–∏ –¥–∞ ‚Üí –¥–æ–∫—É–ø–∫–∞ (—Ñ—å—é—á–µ—Ä—Å + —Å–ø–æ—Ç)
5. –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Ü–µ–Ω: `new_avg = (old_avg * old_qty + new_price * new_qty) / total_qty`
6. –ú–∞–∫—Å–∏–º—É–º 3 –¥–æ–∫—É–ø–∫–∏ (–∏—Ç–æ–≥–æ 4 –≤—Ö–æ–¥–∞)
7. –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ PnL —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã—Ö —Ü–µ–Ω

### üÜï –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–æ–∫—É–ø–æ–∫?

```python
# config.py
ENABLE_POSITION_ADDITIONS = False
```

–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ (1 –≤—Ö–æ–¥ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é).

### üÜï –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–∫—É–ø–æ–∫?

```python
# config.py

# –ë–æ–ª—å—à–µ –¥–æ–∫—É–ø–æ–∫ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: –±–æ–ª—å—à–µ —Ä–∏—Å–∫!)
MAX_POSITION_ADDITIONS = 5  # –ë—ã–ª–æ 3

# –ë–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –¥–æ–∫—É–ø–∫–∏ (–º–µ–Ω—å—à–∏–π –ø—Ä–∏—Ä–æ—Å—Ç —Å–ø—Ä–µ–¥–∞)
ADDITION_SPREAD_INCREMENT = 0.10  # –ë—ã–ª–æ 0.15

# –ë–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–π cooldown
ADDITION_COOLDOWN_SEC = 180  # –ë—ã–ª–æ 300 (3 –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 5)
```

‚ö†Ô∏è **–†–ò–°–ö–ò**:
- –ë–æ–ª—å—à–µ –≤—Ö–æ–¥–æ–≤ = –±–æ–ª—å—à–µ —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
- –ú–µ–Ω—å—à–∏–π increment = —á–∞—â–µ –¥–æ–∫—É–ø–∫–∏ = –±–æ–ª—å—à–µ –∫–æ–º–∏—Å—Å–∏–π
- –ö–æ—Ä–æ—Ç–∫–∏–π cooldown = –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∞–Ω–∞–ª–∏–∑

### üÜï –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∏—Ü–∏–∏ —Å –¥–æ–∫—É–ø–∫–∞–º–∏?

```
/positions - –ø–æ–∫–∞–∂–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤ –∏ —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã
/history   - –ø–æ–∫–∞–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤—Ö–æ–¥–æ–≤
```

### üÜï –í–ª–∏—è—é—Ç –ª–∏ –¥–æ–∫—É–ø–∫–∏ –Ω–∞ —Ä–∞—Å—á–µ—Ç PnL?

**–î–∞!** PnL —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã—Ö —Ü–µ–Ω:

```python
# –ë–µ–∑ –¥–æ–∫—É–ø–æ–∫
entry_price = 45000
exit_price = 45500
pnl = (45500 - 45000) * qty = +500

# –° –¥–æ–∫—É–ø–∫–∞–º–∏ (3 –≤—Ö–æ–¥–∞)
avg_entry_price = 45150  # –£—Å—Ä–µ–¥–Ω–µ–Ω–æ
exit_price = 45500
pnl = (45500 - 45150) * total_qty = –±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª–∏ –ø—Ä–∏ –±–æ–ª—å—à–µ–º –æ–±—ä–µ–º–µ!
```

### –ü–æ—á–µ–º—É —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ—å—é—á–µ—Ä—Å, –∞ –Ω–µ —Å–ø–æ—Ç?

–§—å—é—á–µ—Ä—Å –∫—Ä–∏—Ç–∏—á–Ω–µ–µ –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞:
- –ï—Å–ª–∏ —Å–ø–æ—Ç –Ω–µ –∫—É–ø–∏—Ç—Å—è, –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å —Ñ—å—é—á–µ—Ä—Å –±–µ–∑ —É–±—ã—Ç–∫–∞
- –ï—Å–ª–∏ —Ñ—å—é—á–µ—Ä—Å –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —Å–ø–æ—Ç–∞, –±—É–¥–µ–º –¥–µ—Ä–∂–∞—Ç—å —Å–ø–æ—Ç —Å —Ä–∏—Å–∫–æ–º –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–ø–æ—Ç–∞ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ—å—é—á–µ—Ä—Å–∞ ‚Üí –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏?

```python
# config.py
TRADE_AMOUNT_USD = 50.0  # –ë—ã–ª–æ 30.0
```

**‚ö†Ô∏è –ü—Ä–∏ –¥–æ–∫—É–ø–∫–∞—Ö**: –ö–∞–∂–¥–∞—è –¥–æ–∫—É–ø–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ `TRADE_AMOUNT_USD`, —Ç–æ –µ—Å—Ç—å –∏—Ç–æ–≥–æ–≤–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è = `TRADE_AMOUNT_USD * (1 + MAX_POSITION_ADDITIONS)`

### –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π?

```python
# config.py
MAX_CONCURRENT_POSITIONS = 3  # –ë—ã–ª–æ 1
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –±–∞–ª–∞–Ω—Å–∞ USDT –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ rate limits!

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –±–æ—Ç —É–ø–∞–ª?

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: `python main.py`
2. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π –∏–∑ –ë–î
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram - –ø—Ä–∏–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
5. üÜï –ü–æ—Ç–æ–∫–∏ –¥–æ–∫—É–ø–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—è—Ç—Å—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π

### –ü–æ—á–µ–º—É –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (–ª–æ–≥–∏: "‚úÖ Telegram Bot polling –∑–∞–ø—É—â–µ–Ω")
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω chat_id –≤ `ADMIN_CHAT_IDS`:
   - –ù–∞–ø–∏—Å–∞—Ç—å `/start` –±–æ—Ç—É
   - –í –ª–æ–≥–∞—Ö –Ω–∞–π—Ç–∏ —Å–≤–æ–π chat_id
   - –î–æ–±–∞–≤–∏—Ç—å –≤ `telegram_bot/config.py`
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `ENABLE_NOTIFICATIONS = True` –≤ config
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ `.env`

### –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?

```python
# telegram_bot/config.py
ENABLE_NOTIFICATIONS = False
```

–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (/start, /status, /positions, /stats) –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤?

```python
# telegram_bot/config.py
ADMIN_CHAT_IDS = [
    123456789,   # –ê–¥–º–∏–Ω 1
    987654321,   # –ê–¥–º–∏–Ω 2
    555777999,   # –ê–¥–º–∏–Ω 3
]
```

–í—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

### –ö–∞–∫ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä?

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã:
scp arbitrage.db user@server:/path/to/project/
scp -r migrations/ user@server:/path/to/project/
scp .env user@server:/path/to/project/

# –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ:
pip install -r requirements.txt
alembic upgrade head
python main.py
```

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 6.0 (Pyramiding Edition) üÜï  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –Ø–Ω–≤–∞—Ä—å 2026  
**–ê–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞**: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä  
**Exchange**: Bybit  
**Strategy**: Spot-Futures Arbitrage (Cash & Carry) + Position Pyramiding  
**Storage**: SQLite (SQLAlchemy ORM) + Alembic Migrations  
**Notifications**: Telegram Bot (python-telegram-bot v20+)  
**New Feature**: Automated Position Additions with Weighted Average Pricing üéØ
